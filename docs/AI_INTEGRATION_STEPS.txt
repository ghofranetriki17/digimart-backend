DIGIMART - AI INTEGRATION STEPS (GEMINI)
=======================================

Purpose
-------
Reusable AI text generation for multiple features (categories now, products later).

What we implemented (100% matching code)
---------------------------------------
1) Application port (clean arch)
   - AiTextProvider (application port/out)
     File: digimart-application/src/main/java/com/nexashop/application/port/out/AiTextProvider.java

2) Infrastructure adapter (Gemini)
   - GeminiAiTextProvider (HTTP + JSON)
     File: digimart-infrastructure/src/main/java/com/nexashop/infrastructure/ai/GeminiAiTextProvider.java
   - DisabledAiTextProvider throws ExternalServiceException when provider or key is missing
     File: digimart-infrastructure/src/main/java/com/nexashop/infrastructure/ai/DisabledAiTextProvider.java

3) API config + wiring
   - AiConfig selects provider and reads config
     File: digimart-api/src/main/java/com/nexashop/api/config/AiConfig.java
   - Properties (defaults):
     ai.provider=gemini
     ai.gemini.api-key=${GEMINI_API_KEY}
     ai.gemini.model=gemini-2.5-flash
     ai.gemini.base-url=https://generativelanguage.googleapis.com

4) Exception mapping
   - ExternalServiceException -> 502 Bad Gateway
     File: digimart-api/src/main/java/com/nexashop/api/exception/GlobalExceptionHandler.java

5) Category AI integration (feature-gated)
   - CategoryUseCase builds prompt and calls AiTextProvider
   - Feature gate: AI_DESCRIPTION_GENERATION
     - Enforced for non SUPER_ADMIN
     - Uses TenantSubscription + PlanFeature + PremiumFeature
   File: digimart-application/src/main/java/com/nexashop/application/usecase/CategoryUseCase.java
   Endpoint:
   - POST /api/categories/{id}/ai-description
     File: digimart-api/src/main/java/com/nexashop/api/controller/catalog/CategoryController.java

6) Generic AI endpoint
   - Use case: AiTextUseCase (requires authenticated user)
     File: digimart-application/src/main/java/com/nexashop/application/usecase/AiTextUseCase.java
   - API endpoint:
     POST /api/ai/text
     Request: { "prompt": "..." }
     Response: { "text": "..." }
     File: digimart-api/src/main/java/com/nexashop/api/controller/ai/AiController.java

How Gemini is called (exact behavior)
------------------------------------
- Endpoint: {baseUrl}/v1beta/models/{model}:generateContent
- Header: x-goog-api-key: <GEMINI_API_KEY>
- Payload: { "contents": [ { "parts": [ { "text": "<prompt>" } ] } ] }
- Timeout: 30s

How to configure the API key
----------------------------
Option A (PowerShell):
  $env:GEMINI_API_KEY="YOUR_KEY"
  ./mvnw -pl digimart-api -am spring-boot:run

Option B (VS Code launch.json):
  "env": { "GEMINI_API_KEY": "YOUR_KEY" }

Test endpoints (Thunder/cURL)
-----------------------------
1) Category AI:
  POST /api/categories/{id}/ai-description
  Body:
  {
    "language": "FR",
    "maxSentences": 2,
    "tone": "neutre"
  }

2) Generic AI:
  POST /api/ai/text
  Body:
  {
    "prompt": "Ameliore cette description en FR: ..."
  }

Notes for jury/encadreur (accurate)
-----------------------------------
- Clean architecture respected (port in application, adapter in infrastructure).
- AI calls centralized in AiTextProvider + AiTextUseCase.
- Missing provider or key => DisabledAiTextProvider => 502.
- Category AI is feature-gated by plan (AI_DESCRIPTION_GENERATION).
- Generic AI endpoint still requires authentication (requireUser).
