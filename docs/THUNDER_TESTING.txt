Thunder Client - Full Test Steps (Auth + Tenant + User)

Prerequisites
1) PostgreSQL is running and the database exists:
   - DB: digimart_db
   - User: postgres
   - Password: admin
2) If you use different credentials, update:
   digimart-api/src/main/resources/application.properties
3) Seed data (recommended):
   - Run docs/SEED_SQL.sql

Run the API
1) From the repo root:
   mvn -pl digimart-api -am spring-boot:run
2) Server starts on:
   http://localhost:8080

Auth
Request 1: Login as SUPER_ADMIN (seeded)
Method: POST
URL: http://localhost:8080/api/auth/login
Headers:
  Content-Type: application/json
Body (JSON):
{
  "email": "admin@demo.com",
  "password": "Password123!"
}
Expected:
- 200 OK
- roles include SUPER_ADMIN (and OWNER/ADMIN)
Save token as <super_token>

Request 2: Register tenant (step1)
Method: POST
URL: http://localhost:8080/api/auth/register-tenant/step1
Headers:
  Content-Type: application/json
Body (JSON):
{
  "tenantName": "New Tenant",
  "contactEmail": "owner@new.com",
  "contactPhone": "+212633333333",
  "status": "ACTIVE",
  "defaultLocale": "FR",
}
Expected:
- 200 OK
- Response includes tenantId + subdomain

Request 3: Register owner (step2)
Method: POST
URL: http://localhost:8080/api/auth/register-tenant/step2
Headers:
  Content-Type: application/json
Body (JSON):
{
  "tenantId": 4,
  "ownerEmail": "owner@new.com",
  "ownerPassword": "Password123!",
  "ownerFirstName": "Owner",
  "ownerLastName": "New"
}
Expected:
- 200 OK
- Response includes token + roles

Tenant
Request 4: List all tenants (SUPER_ADMIN)
Method: GET
URL: http://localhost:8080/api/tenants
Headers:
  Authorization: Bearer <super_token>
Expected:
- 200 OK
- 3 tenants from seed

Request 5: Get tenant by id (OWNER/ADMIN of tenant or SUPER_ADMIN)
Method: GET
URL: http://localhost:8080/api/tenants/1
Headers:
  Authorization: Bearer <super_token>
Expected:
- 200 OK

Request 6: Update tenant (OWNER/ADMIN or SUPER_ADMIN)
Method: PUT
URL: http://localhost:8080/api/tenants/1
Headers:
  Content-Type: application/json
  Authorization: Bearer <super_token>
Body (JSON):
{
  "name": "Demo Tenant Updated",
  "contactEmail": "owner@demo.com",
  "contactPhone": "+212600000000",
  "status": "ACTIVE",
  "defaultLocale": "FR"
}
Expected:
- 200 OK

User
Request 7: List users for tenant (ADMIN or SUPER_ADMIN)
Method: GET
URL: http://localhost:8080/api/users?tenantId=1
Headers:
  Authorization: Bearer <super_token>
Expected:
- 200 OK

Request 8: Get user by id (same tenant or SUPER_ADMIN)
Method: GET
URL: http://localhost:8080/api/users/2
Headers:
  Authorization: Bearer <super_token>
Expected:
- 200 OK

Request 9: Update user (OWNER/ADMIN or SUPER_ADMIN)
Method: PUT
URL: http://localhost:8080/api/users/2
Headers:
  Content-Type: application/json
  Authorization: Bearer <super_token>
Body (JSON):
{
  "firstName": "StaffUpdated",
  "lastName": "UserUpdated",
  "enabled": true
}
Expected:
- 200 OK

Request 10: Grant ADMIN (OWNER/ADMIN or SUPER_ADMIN)
Method: POST
URL: http://localhost:8080/api/users/2/roles/admin
Headers:
  Authorization: Bearer <super_token>
Expected:
- 200 OK

Request 11: Grant SUPER_ADMIN (SUPER_ADMIN only)
Method: POST
URL: http://localhost:8080/api/users/2/roles/super-admin
Headers:
  Authorization: Bearer <super_token>
Expected:
- 200 OK

Stores (Point de Vente)
Request 12: Create store (OWNER/ADMIN or SUPER_ADMIN)
Method: POST
URL: http://localhost:8080/api/stores
Headers:
  Content-Type: application/json
  Authorization: Bearer <super_token>
Body (JSON):
{
  "tenantId": 1,
  "name": "Store Casablanca",
  "code": "CASA-01",
  "address": "1 Rue Exemple",
  "city": "Casablanca",
  "postalCode": "20000",
  "country": "MA",
  "phone": "+212600000000",
  "email": "store@demo.com",
  "imageUrl": "https://example.com/store.png",
  "latitude": 33.5731,
  "longitude": -7.5898
}
Expected:
- 201 Created

Request 13: List stores (OWNER/ADMIN or SUPER_ADMIN)
Method: GET
URL: http://localhost:8080/api/stores?tenantId=1
Headers:
  Authorization: Bearer <super_token>
Expected:
- 200 OK

Request 14: Get store by id (OWNER/ADMIN or SUPER_ADMIN)
Method: GET
URL: http://localhost:8080/api/stores/{id}
Headers:
  Authorization: Bearer <super_token>
Expected:
- 200 OK

Request 15: Update store (OWNER/ADMIN or SUPER_ADMIN)
Method: PUT
URL: http://localhost:8080/api/stores/{id}
Headers:
  Content-Type: application/json
  Authorization: Bearer <super_token>
Body (JSON):
{
  "name": "Store Casa Updated",
  "address": "2 Rue Exemple",
  "city": "Casablanca",
  "postalCode": "20000",
  "country": "MA",
  "phone": "+212600000001",
  "email": "store@demo.com",
  "imageUrl": "https://example.com/store.png",
  "latitude": 33.5731,
  "longitude": -7.5898,
  "active": true
}
Expected:
- 200 OK

Request 16: Update store image (OWNER/ADMIN or SUPER_ADMIN)
Method: POST
URL: http://localhost:8080/api/stores/{id}/image
Headers:
  Content-Type: application/json
  Authorization: Bearer <super_token>
Body (JSON):
{
  "imageUrl": "https://example.com/store-new.png"
}
Expected:
- 200 OK

Request 17: Deactivate store (OWNER/ADMIN or SUPER_ADMIN)
Method: POST
URL: http://localhost:8080/api/stores/{id}/deactivate
Headers:
  Authorization: Bearer <super_token>
Expected:
- 200 OK

Request 18: Activate store (OWNER/ADMIN or SUPER_ADMIN)
Method: POST
URL: http://localhost:8080/api/stores/{id}/activate
Headers:
  Authorization: Bearer <super_token>
Expected:
- 200 OK

Request 19: Delete store (OWNER/ADMIN or SUPER_ADMIN)
Method: DELETE
URL: http://localhost:8080/api/stores/{id}
Headers:
  Authorization: Bearer <super_token>
Expected:
- 204 No Content

Public endpoints
Request 20: Create tenant (public)
Method: POST
URL: http://localhost:8080/api/tenants
Headers:
  Content-Type: application/json
Body (JSON):
{
  "name": "New Tenant",
  "subdomain": "new-tenant",
  "contactEmail": "owner@new.com",
  "contactPhone": "+212633333333",
  "status": "TRIAL",
  "defaultLocale": "EN"
}
Expected:
- 201 Created

Request 21: Create user (OWNER/ADMIN or SUPER_ADMIN)
Method: POST
URL: http://localhost:8080/api/users
Headers:
  Content-Type: application/json
  Authorization: Bearer <super_token>
Body (JSON):
{
  "tenantId": 2,
  "email": "member@trial.com",
  "password": "Password123!",
  "firstName": "Member",
  "lastName": "Trial",
  "enabled": true
}
Expected:
- 201 Created

Negative cases
- GET /api/tenants without token => 401
- GET /api/users?tenantId=1 with non-admin => 403
- PUT /api/tenants/2 with tenant 1 admin => 403
- POST /api/users/2/roles/super-admin without SUPER_ADMIN => 403
- POST /api/auth/login with wrong password => 401
- GET /api/stores?tenantId=1 without OWNER/ADMIN => 403
- POST /api/users without token => 401